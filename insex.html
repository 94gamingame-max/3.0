<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç”·æ¨¡è©±è¡“é˜²ç¦¦æˆ° | @ypps_</title>
    <!-- ä½¿ç”¨ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ä½¿ç”¨ Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        /* è²¼åœ–å½ˆè·³å‹•ç•« */
        @keyframes stickerBounce { 
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .animate-fade-in { animation: fadeIn 0.8s ease-out; }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; opacity: 0; }
        .animate-sticker { animation: stickerBounce 2s infinite ease-in-out; }
        
        /* éš±è—æ»¾å‹•æ¢ä½†ä¿æŒåŠŸèƒ½ */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .ios-scroll { -webkit-overflow-scrolling: touch; }
    </style>
</head>
<body class="bg-[#191F2C] text-white font-sans overflow-hidden select-none"> 

    <!-- å…¨åŸŸç‰ˆæ¬Šæµ®æ°´å° -->
    <div class="fixed bottom-2 w-full text-center z-50 pointer-events-auto">
        <a href="https://www.instagram.com/ypps_" target="_blank" class="text-[10px] text-white/30 hover:text-white/80 transition-colors font-medium tracking-widest">
            DESIGNED BY <i class="fa-brands fa-instagram"></i> YPPS_
        </a>
    </div>

    <div id="app" class="relative min-h-screen flex flex-col items-center justify-center"></div>
    <input type="file" id="fileInput" accept="image/*" class="hidden" onchange="handleImageUpload(event)">

    <script>
        // ==========================================
        // åœ–ç‰‡è³‡æºè¨­å®š (å·²ä¿®å¾©é€£çµ)
        // ==========================================
        // ä½¿ç”¨ URL ç·¨ç¢¼ (: -> %3A) ä»¥é¿å…è§£æéŒ¯èª¤
        const HOST_AVATAR = "https://media.vogue.com.tw/photos/5fa13c62e4b5bd774a1a80e5/2%3A3/w_2240,c_limit/GQCoverA.jpg";
        
        // å‚™ç”¨åœ–ç‰‡ï¼šå¦‚æœä¸Šæ–¹åœ–ç‰‡ç„¡æ³•è®€å–ï¼Œè‡ªå‹•åˆ‡æ›è‡³æ­¤
        const FALLBACK_AVATAR = "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=facearea&facepad=2&w=400&h=400&q=80";

        let state = {
            gameState: 'start',
            score: 0,
            history: [],
            userImage: null
        };

        function getCurrentAvatar() { return state.userImage || HOST_AVATAR; }

        function getTimeString() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // æ¸…ç†é¸é …æ–‡å­— (ç§»é™¤ A. B. C.)
        function cleanChoiceText(text) {
            if (!text) return "";
            return text.replace(/^[A-C]\.\s*/, '');
        }

        // è™•ç†åœ–ç‰‡è¼‰å…¥éŒ¯èª¤
        window.handleImgError = function(img) {
            // é˜²æ­¢ç„¡é™è¿´åœˆ
            img.onerror = null;
            img.src = FALLBACK_AVATAR;
        };

        function startGame() { state.gameState = 'chat1'; render(); }
        
        function resetGame() {
            state.gameState = 'start';
            state.score = 0;
            state.history = [];
            render();
        }

        function handleChoice(points, nextState, choiceText) {
            state.score += points;
            state.history.push(choiceText);
            state.gameState = nextState;
            render();
        }

        function triggerFileUpload() { document.getElementById('fileInput').click(); }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                state.userImage = URL.createObjectURL(file);
                render();
            }
        }

        const app = document.getElementById('app');

        function getBackgroundHTML() {
            return `
                <div class="fixed inset-0 z-0 bg-[#191F2C] pointer-events-none">
                    <div class="absolute inset-0 bg-gradient-to-b from-black/20 to-transparent"></div>
                </div>
            `;
        }

        function renderStartScreen() {
            const currentAvatar = getCurrentAvatar();
            return `
                ${getBackgroundHTML()}
                <div class="z-10 text-center max-w-md w-full p-8 animate-fade-in mx-4">
                    <div class="mb-6 flex flex-col items-center justify-center">
                        <div class="relative w-28 h-28 group cursor-pointer" onclick="triggerFileUpload()">
                            <img src="${currentAvatar}" onerror="handleImgError(this)" class="w-full h-full rounded-full object-cover border-4 border-white/10 shadow-2xl group-hover:border-purple-400 transition-all duration-300">
                            <div class="absolute -bottom-1 -right-1 bg-green-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full border border-[#191F2C] z-10">LINE</div>
                        </div>
                        <p class="text-xs text-gray-400 mt-3 flex items-center gap-1 animate-pulse"><i class="fa-solid fa-camera"></i> é»æ“Šé ­åƒæ›äºº</p>
                    </div>
                    
                    <div class="mb-4 inline-block px-3 py-1 rounded-full bg-white/5 border border-white/5">
                        <p class="text-[10px] text-gray-400 tracking-wider">IG: @YPPS_ åŸå‰µä¼åŠƒ</p>
                    </div>

                    <h1 class="text-2xl font-bold mb-2 text-white">ç”·æ¨¡è©±è¡“é˜²ç¦¦æˆ°</h1>
                    <p class="text-gray-400 mb-8 text-base">ç•¶ã€Œä»–ã€è·³éå‘Šç™½ç›´æ¥å–Šè€å©†...<br/>å¦³çš„ç†æ™ºç·šèƒ½æ’å¹¾ç§’ï¼Ÿ</p>
                    
                    <button onclick="startGame()" class="w-full py-3 bg-[#06C755] hover:bg-[#05b54d] text-white rounded-lg font-bold text-lg shadow-md transform transition active:scale-95 flex items-center justify-center gap-2">
                        é€²å…¥èŠå¤©å®¤
                    </button>
                    <p class="mt-4 text-xs text-gray-500">è­¦å‘Šï¼šæœ¬æ¸¬é©—å«æœ‰é«˜æ¿ƒåº¦å¿ƒç†åšå¼ˆ</p>
                </div>
            `;
        }

        function renderChatScreen(senderName, messages, choices) {
            const currentAvatar = getCurrentAvatar();
            const timeStr = getTimeString();
            // åŠ å¿«ç¯€å¥è‡³ 0.5 ç§’
            const MSG_INTERVAL = 0.5;

            let messagesHTML = messages.map((msg, idx) => {
                const delay = idx * MSG_INTERVAL;
                const isUser = msg.isUser;
                const isSticker = msg.type === 'sticker';
                const alignmentClass = isUser ? 'justify-end' : 'justify-start';
                
                let bubbleClass = '';
                if (!isSticker) {
                    bubbleClass = isUser 
                        ? 'bg-[#06C755] text-white rounded-2xl rounded-tr-sm p-3 shadow-sm' 
                        : 'bg-[#282f3c] text-white rounded-2xl rounded-tl-sm p-3 shadow-sm';
                }
                    
                const avatarHTML = !isUser ? 
                    `<div class="flex flex-col items-center mr-2 mt-1">
                        <div class="w-10 h-10 rounded-full overflow-hidden flex-shrink-0 bg-gray-300">
                            <img src="${currentAvatar}" onerror="handleImgError(this)" class="w-full h-full object-cover">
                        </div>
                    </div>` : '';

                let contentHTML = '';
                
                if (isUser) {
                    // ç”¨æˆ¶ (å³å´)
                    contentHTML = `
                        <div class="flex items-end justify-end">
                            <div class="flex flex-col items-end mr-1.5 min-w-[30px]">
                                <span class="text-[10px] text-[#06C755] font-medium leading-tight">å·²è®€</span>
                                <span class="text-[10px] text-gray-400 leading-tight">${timeStr}</span>
                            </div>
                            <div class="max-w-[70%]">
                                <div class="text-[15px] leading-relaxed break-words ${bubbleClass}">
                                    ${msg.text}
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    // å°æ–¹ (å·¦å´)
                    const messageContent = isSticker 
                        ? `<div class="text-7xl drop-shadow-md transform origin-left hover:scale-105 transition-transform duration-300 select-none animate-sticker">${msg.text}</div>`
                        : `<div class="text-[15px] leading-relaxed break-words ${bubbleClass}">${msg.text}</div>`;

                    contentHTML = `
                        <div class="flex items-start">
                            ${avatarHTML}
                            <div class="flex flex-col max-w-[75%]">
                                <div class="text-[11px] text-gray-300 mb-1 ml-1">${senderName}</div>
                                <div class="flex items-end">
                                    ${messageContent}
                                    <span class="text-[10px] text-gray-400 ml-1.5 whitespace-nowrap mb-0.5">${timeStr}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }

                return `
                    <div class="flex ${alignmentClass} animate-slide-up mb-4 w-full" style="animation-delay: ${delay}s">
                        ${contentHTML}
                    </div>
                `;
            }).join('');
            
            const choicesDelay = messages.length * MSG_INTERVAL;
            
            let choicesHTML = choices.map(choice => `
                <button onclick="handleChoice(${choice.points}, '${choice.nextState}', '${choice.text}')" 
                    class="w-full mb-2 py-3 px-4 bg-[#282f3c] hover:bg-[#343b4a] border border-gray-700/50 rounded-xl text-left transition-all active:scale-[0.98] flex justify-between items-center shadow-md">
                    <span class="text-[14px] text-white">${choice.text}</span>
                    <i class="fa-solid fa-chevron-right text-gray-500 text-xs"></i>
                </button>`).join('');

            return `
                <div class="absolute inset-0 w-full h-full flex flex-col font-sans bg-[#191F2C]">
                    <!-- Header -->
                    <div class="bg-[#191F2C]/90 backdrop-blur-sm p-3 flex items-center justify-between border-b border-gray-800 z-20 shadow-sm sticky top-0 h-14">
                        <div class="flex items-center gap-3">
                            <i class="fa-solid fa-chevron-left text-white text-lg"></i>
                            <div class="font-bold text-lg text-white">${senderName} <i class="fa-solid fa-volume-xmark text-xs text-gray-500 ml-1"></i></div>
                        </div>
                        <div class="flex gap-4 text-white text-lg pr-2">
                            <i class="fa-solid fa-magnifying-glass"></i>
                            <i class="fa-solid fa-phone"></i>
                            <i class="fa-solid fa-bars"></i>
                        </div>
                    </div>

                    <!-- èŠå¤©å…§å®¹å€åŸŸ -->
                    <div class="flex-1 overflow-y-auto px-4 py-4 pb-64 ios-scroll scroll-smooth scrollbar-hide w-full" id="chatContainer">
                        ${messagesHTML}
                        <div class="h-4"></div>
                    </div>

                    <!-- åº•éƒ¨é¸é …å€ -->
                    <div class="absolute bottom-0 left-0 w-full bg-[#191F2C]/95 backdrop-blur-md border-t border-gray-800 pt-3 pb-8 px-4 z-30"
                         style="opacity: 0; animation: fadeIn 0.5s ease-out forwards; animation-delay: ${choicesDelay}s">
                        <div class="max-w-md mx-auto">
                            <p class="text-xs text-gray-500 mb-2 text-center">è«‹é¸æ“‡å›æ‡‰</p>
                            ${choicesHTML}
                        </div>
                    </div>
                </div>
            `;
        }

        function scrollToBottom() {
            setTimeout(() => {
                const container = document.getElementById('chatContainer');
                if (container) {
                    container.scrollTop = container.scrollHeight;
                }
            }, 100);
        }

        function renderResultScreen() {
            let resultTitle, resultDesc, resultColor, iconClass;
            const score = state.score;
            if (score < 8) {
                resultTitle = "æšˆèˆ¹é‡ç—‡æ‚£è€…";
                resultDesc = "å¦³éå¸¸å±éšªï¼å¦³å·²ç¶“æ‰é€²äº†ã€Œæ—¢å®šäº‹å¯¦ã€çš„é™·é˜±ã€‚ä»–è·³éäº†è¿½æ±‚ï¼Œç›´æ¥å«è€å©†ï¼Œå†ç”¨æ‹’çµ•è²´å©¦ä¾†å±•ç¾ã€Œå¦³æœ€ç‰¹åˆ¥ã€ï¼Œæœ€å¾Œé€™æ‹›ã€Œä»¥é€€ç‚ºé€²ã€ç›´æ¥æ”¶å‰²å¦³ã€‚";
                resultColor = "text-pink-400"; iconClass = "fa-triangle-exclamation text-pink-500 animate-bounce";
            } else if (score >= 8 && score < 13) {
                resultTitle = "äººé–“æ¸…é†’è§€å¯Ÿå®¶";
                resultDesc = "å¦³æœ‰ä¸éŒ¯çš„é˜²ç¦¦åŠ›ï¼Œå°æ–¼å¤ªå¿«çš„é€²å±•æ„Ÿåˆ°é²ç–‘ã€‚å¦³çœ‹å‡ºäº†ä»–åœ¨æƒ…æ„Ÿå‹’ç´¢ï¼Œä½†é‚„æ˜¯å¯èƒ½æœƒå› ç‚ºä¸€æ™‚å¿ƒè»Ÿè€Œçµ¦ä»–æ©Ÿæœƒã€‚è¨˜ä½ï¼šçœŸæ­£çš„æ„Ÿæƒ…ä¸æœƒå»ºç«‹åœ¨æ¥­ç¸¾å£“åŠ›ä¸Šã€‚";
                resultColor = "text-yellow-400"; iconClass = "fa-message text-yellow-400";
            } else {
                resultTitle = "å…«å¤§å¿ƒç†å­¸å¤§å¸«";
                resultDesc = "å¤ªå¼·äº†ï¼é€™å¥—ã€Œè€å©†â†’æ‹’çµ•è²´å©¦â†’è³£æ…˜æ”¶ç¶²ã€çš„ä¸‰éƒ¨æ›²å°å¦³å®Œå…¨ç„¡æ•ˆã€‚å¦³ä¸€çœ¼å°±çœ‹ç©¿ä»–åªæ˜¯æƒ³åˆ©ç”¨æƒ…æ„Ÿåšå¼ˆä¾†æ›å–æ¥­ç¸¾ã€‚";
                resultColor = "text-cyan-400"; iconClass = "fa-gem text-cyan-400";
            }

            return `
                ${getBackgroundHTML()}
                <div class="z-10 text-center max-w-md w-full p-8 animate-fade-in mx-4 mt-[-50px]">
                    <div class="flex justify-center mb-6">
                        <div class="w-20 h-20 rounded-full bg-[#282f3c] flex items-center justify-center shadow-lg border border-gray-700">
                            <i class="fa-solid ${iconClass} text-4xl"></i>
                        </div>
                    </div>
                    
                    <h2 class="text-gray-500 text-xs tracking-widest uppercase mb-2">è¨ºæ–·çµæœ</h2>
                    <h1 class="text-2xl font-bold mb-6 ${resultColor}">${resultTitle}</h1>
                    
                    <div class="bg-[#282f3c] p-6 rounded-xl text-left mb-8 border border-gray-700 shadow-md relative">
                        <i class="fa-solid fa-quote-left text-gray-600 absolute top-4 left-4 text-xl"></i>
                        <p class="text-gray-300 leading-relaxed text-sm pt-4 pl-2">${resultDesc}</p>
                    </div>

                    <div class="space-y-3">
                        <button onclick="resetGame()" class="w-full py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-medium transition flex items-center justify-center gap-2 text-sm">
                            <i class="fa-solid fa-rotate-left"></i> å†æ¸¬ä¸€æ¬¡
                        </button>
                        
                        <div class="pt-4 mt-4 border-t border-gray-800 space-y-3">
                            <p class="text-xs text-gray-500 mb-1">è¦ºå¾—æº–å—ï¼Ÿæˆªåœ–ç™¼é™å‹•</p>
                            <a href="https://www.instagram.com/ypps_" target="_blank" class="block w-full py-3 bg-gradient-to-r from-purple-900 to-purple-800 rounded-lg text-sm font-medium hover:opacity-90 transition">
                                <i class="fa-brands fa-instagram mr-1"></i> æ¨™è¨˜ @YPPS_ çœ‹æ›´å¤šè§£æ
                            </a>

                            <!-- æ­¡è¿æŠ•ç¨¿å€å¡Š -->
                             <a href="https://www.instagram.com/ypps_" target="_blank" class="block w-full py-3 bg-[#1e2532] border border-gray-700 hover:bg-[#252b38] hover:border-gray-600 rounded-lg text-sm font-medium transition group relative overflow-hidden">
                                <div class="absolute top-0 right-0 bg-red-500 text-white text-[9px] px-2 py-0.5 rounded-bl-lg font-bold">æ­¡è¿æŠ•ç¨¿</div>
                                <div class="flex items-center justify-center gap-2 text-gray-300 group-hover:text-white">
                                    <i class="fa-regular fa-paper-plane"></i> é‡éæ›´æ‰¯çš„ï¼Ÿç§è¨ŠçœŸäººçœŸäº‹
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        function render() {
            let html = '';
            if (state.gameState === 'start') {
                html = renderStartScreen();
            } else if (state.gameState === 'chat1') {
                html = renderChatScreen('Leo', [
                    { isUser: false, text: "æˆ‘è¦å…ˆèµ°äº† ä½†æˆ‘ä¸æƒ³è·Ÿå¥¹å€‘èªªå¯¦è©±" },
                    { isUser: false, text: "æˆ‘è·Ÿå¥¹å€‘èªªæˆ‘è¦å»æ‰¾æˆ‘è€å©† æˆ‘æ€•æˆ‘è€å©†æƒ³æˆ‘äº†" },
                    { isUser: false, text: "ç­‰ä¸‹å¸¶å¦³å»åƒå®µå¤œï¼Ÿ" }
                ], [
                    { text: "A. (è‡‰ç´…) èª°æ˜¯ä½ è€å©†å•¦...å¥½å•¦ç­‰ä½ ", points: 0, nextState: 'chat2' },
                    { text: "B. ä½ é€™æ¨£è¬›å¥½å—ï¼Ÿæˆ‘å€‘åˆé‚„æ²’åœ¨ä¸€èµ·", points: 2, nextState: 'chat2' },
                    { text: "C. (å¿ƒæƒ³ï¼šè·³éå‘Šç™½ï¼ŸSOPå¤ªæ˜é¡¯å›‰)", points: 5, nextState: 'chat2' }
                ]);
            } else if (state.gameState === 'chat2') {
                let introMsg = "";
                // å¢åŠ é˜²å‘†æª¢æŸ¥
                let userChoice = state.history[0] || ""; 
                let cleanUserChoice = cleanChoiceText(userChoice);

                if (userChoice && userChoice.includes("A.")) {
                    introMsg = "ä¹– é€™å°±æ˜¯ç‚ºä»€éº¼æˆ‘æœ€å–œæ­¡å¦³";
                } else {
                    introMsg = "å‚»ç“œ é‚£äº›ä¸é‡è¦"; 
                }

                html = renderChatScreen('Leo', [
                    { isUser: true, text: cleanUserChoice }, // é¡¯ç¤ºç”¨æˆ¶é¸æ“‡
                    { isUser: true, text: "ä½ å‰›å‰›é‚£æ¡Œä¸æ˜¯å¤§æˆ¶å—ï¼Ÿä½ å°±é€™æ¨£è·‘å‡ºä¾†" },
                    { isUser: false, text: introMsg },
                    { isUser: false, type: 'sticker', text: 'ğŸ˜˜' },
                    { isUser: false, text: "é‚£å€‹è²´å©¦å‰›å‰›è¦æ¡†æˆ‘åˆ°åº• ä½†æˆ‘æ‹’çµ•äº†" },
                    { isUser: false, text: "æˆ‘è·Ÿå¥¹èªªä¸è¡Œ æˆ‘æœ‰æ›´é‡è¦çš„äººè¦é™ª" }
                ], [
                    { text: "A. å¤©å•Šä½ å°æˆ‘å¥½å¥½...æˆ‘æœ‰é»æ„Ÿå‹•", points: 0, nextState: 'chat3' },
                    { text: "B. é€™æ¨£ä½ æœƒä¸æœƒè¢«æ‰£éŒ¢å•Šï¼Ÿ", points: 2, nextState: 'chat3' },
                    { text: "C. (è½è½å°±å¥½ï¼Œä¸äºˆç½®è©•)", points: 5, nextState: 'chat3' }
                ]);
            } else if (state.gameState === 'chat3') {
                // å¢åŠ é˜²å‘†æª¢æŸ¥
                let userChoice = state.history[1] || "";
                let cleanUserChoice = cleanChoiceText(userChoice);

                html = renderChatScreen('Leo', [
                    { isUser: true, text: cleanUserChoice }, // é¡¯ç¤ºç”¨æˆ¶é¸æ“‡
                    { isUser: false, text: "å”‰...å¹¹éƒ¨å‰›å‰›ä¸€ç›´å‚³è¨Šæ¯ç½µæˆ‘" },
                    { isUser: false, text: "ä½†æˆ‘çœŸçš„ä¸æƒ³å›å»é¢å°é‚£å€‹é˜¿å§¨" },
                    { isUser: false, type: 'sticker', text: 'ğŸ¥º' },
                    { isUser: false, text: "å…¶å¯¦æˆ‘ä»Šå¤©é‚„å·®ä¸€é»æ¥­ç¸¾..." },
                    { isUser: false, text: "å¯¶è² å¦³èƒ½ä¸èƒ½éä¾†å¹«æˆ‘åå€‹ååˆ†é˜å°±å¥½ï¼Ÿè®“æˆ‘äº¤å·®" }
                ], [
                    { text: "A. å¥½å•¦...åªæœ‰ååˆ†é˜å–” (é¦¬ä¸Šå‡ºé–€)", points: 0, nextState: 'result' },
                    { text: "B. æˆ‘å»æ˜¯å¯ä»¥ï¼Œä½†æˆ‘ä¸å–é…’å–”", points: 2, nextState: 'result' },
                    { text: "C. æŠ±æ­‰æˆ‘ç´¯äº†ï¼Œæ”¹å¤©å§ (æœæ–·æ”¾ç”Ÿ)", points: 5, nextState: 'result' }
                ]);
            } else if (state.gameState === 'result') {
                html = renderResultScreen();
            }
            app.innerHTML = html;
            
            if (state.gameState.startsWith('chat')) {
                scrollToBottom();
            }
        }
        render();
    </script>
</body>
</html>